<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Login - eTax</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .debug-container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .step { margin: 10px 0; padding: 10px; border-left: 4px solid #007bff; }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üîç Debug Login System</h1>
        
        <div class="debug-section info">
            <h3>B∆∞·ªõc 1: Ki·ªÉm tra Demo Account</h3>
            <button onclick="checkDemoAccount()">Ki·ªÉm tra Demo Account</button>
            <div id="demo-result"></div>
        </div>

        <div class="debug-section info">
            <h3>B∆∞·ªõc 2: T·∫°o Demo Account Th·ªß C√¥ng</h3>
            <button onclick="createDemoAccountManual()">T·∫°o Demo Account</button>
            <div id="create-result"></div>
        </div>

        <div class="debug-section info">
            <h3>B∆∞·ªõc 3: Test Login Logic</h3>
            <input type="text" id="test-mst" placeholder="MST" value="1221995" style="padding: 8px; margin: 5px;">
            <input type="password" id="test-password" placeholder="Password" value="123456" style="padding: 8px; margin: 5px;">
            <button onclick="testLogin()">Test Login</button>
            <div id="login-result"></div>
        </div>

        <div class="debug-section info">
            <h3>B∆∞·ªõc 4: Ki·ªÉm tra localStorage</h3>
            <button onclick="checkLocalStorage()">Ki·ªÉm tra localStorage</button>
            <div id="storage-result"></div>
        </div>

        <div class="debug-section info">
            <h3>B∆∞·ªõc 5: Test Redirect</h3>
            <button onclick="testRedirect()">Test Redirect</button>
            <div id="redirect-result"></div>
        </div>
    </div>

    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            element.innerHTML = `<div class="step ${className}">${message}</div>`;
            console.log(message);
        }

        function checkDemoAccount() {
            const demoMST = '1221995';
            const userData = localStorage.getItem(`etax_user_data_${demoMST}`);
            
            if (userData) {
                try {
                    const parsed = JSON.parse(userData);
                    log('demo-result', `‚úÖ Demo account t·ªìn t·∫°i!<br><pre>${JSON.stringify(parsed, null, 2)}</pre>`, 'success');
                } catch (e) {
                    log('demo-result', `‚ùå Demo account b·ªã l·ªói format: ${e.message}`, 'error');
                }
            } else {
                log('demo-result', '‚ùå Demo account kh√¥ng t·ªìn t·∫°i!', 'error');
            }
        }

        function createDemoAccountManual() {
            const demoMST = '1221995';
            const demoPassword = '123456';
            
            const demoUserData = {
                mst: demoMST,
                password: demoPassword,
                companyName: 'C√¥ng ty Demo Testing',
                address: '123 ƒê∆∞·ªùng Demo, Qu·∫≠n 1, TP.HCM',
                phone: '0123456789',
                email: 'demo@etax.com',
                representative: 'Nguy·ªÖn VƒÉn Demo',
                fullName: 'Nguy·ªÖn VƒÉn Demo',
                businessType: 'C√¥ng ty TNHH',
                taxOffice: 'C·ª•c Thu·∫ø TP.HCM',
                taxInfo: {
                    period: '2024',
                    quarter: 'Q4',
                    revenue: 1000000000,
                    tax: 100000000,
                    status: 'ƒê√£ n·ªôp'
                },
                createdAt: new Date().toISOString(),
                createdBy: 'manual-debug'
            };
            
            try {
                localStorage.setItem(`etax_user_data_${demoMST}`, JSON.stringify(demoUserData));
                log('create-result', `‚úÖ ƒê√£ t·∫°o demo account th√†nh c√¥ng!<br><pre>${JSON.stringify(demoUserData, null, 2)}</pre>`, 'success');
            } catch (e) {
                log('create-result', `‚ùå L·ªói t·∫°o demo account: ${e.message}`, 'error');
            }
        }

        function testLogin() {
            const mst = document.getElementById('test-mst').value;
            const password = document.getElementById('test-password').value;
            
            log('login-result', `üîç Testing login v·ªõi MST: ${mst}, Password: ${password}`, 'info');
            
            // L·∫•y d·ªØ li·ªáu t·ª´ localStorage
            const userDataKey = `etax_user_data_${mst}`;
            const userData = JSON.parse(localStorage.getItem(userDataKey) || 'null');
            
            if (!userData) {
                log('login-result', `‚ùå Kh√¥ng t√¨m th·∫•y user data v·ªõi key: ${userDataKey}`, 'error');
                return;
            }
            
            log('login-result', `‚úÖ T√¨m th·∫•y user data:<br><pre>${JSON.stringify(userData, null, 2)}</pre>`, 'info');
            
            if (userData.password !== password) {
                log('login-result', `‚ùå Password kh√¥ng ƒë√∫ng. Expected: ${userData.password}, Got: ${password}`, 'error');
                return;
            }
            
            log('login-result', `‚úÖ Login th√†nh c√¥ng! T·∫°o session...`, 'success');
            
            // T·∫°o session
            localStorage.setItem('etax_logged_in_user', mst);
            localStorage.setItem('etax_user_info', JSON.stringify({
                mst: userData.mst,
                fullName: userData.representative || userData.companyName || 'Ng∆∞·ªùi d√πng',
                companyName: userData.companyName,
                address: userData.address,
                taxOffice: userData.taxOffice || 'C·ª•c Thu·∫ø TP.HCM',
                phone: userData.phone,
                email: userData.email
            }));
            localStorage.setItem('etax_user_data', JSON.stringify(userData));
            
            log('login-result', `‚úÖ Session ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!`, 'success');
        }

        function checkLocalStorage() {
            const keys = Object.keys(localStorage);
            const etaxKeys = keys.filter(key => key.startsWith('etax_'));
            
            let result = `üìã T·∫•t c·∫£ localStorage keys li√™n quan ƒë·∫øn eTax:<br><br>`;
            
            if (etaxKeys.length === 0) {
                result += `‚ùå Kh√¥ng c√≥ keys n√†o!`;
                log('storage-result', result, 'error');
                return;
            }
            
            etaxKeys.forEach(key => {
                const value = localStorage.getItem(key);
                result += `<strong>${key}:</strong><br><pre>${value}</pre><br>`;
            });
            
            log('storage-result', result, 'success');
        }

        function testRedirect() {
            const loggedInUser = localStorage.getItem('etax_logged_in_user');
            
            if (!loggedInUser) {
                log('redirect-result', '‚ùå Ch∆∞a c√≥ user ƒëƒÉng nh·∫≠p. H√£y test login tr∆∞·ªõc!', 'error');
                return;
            }
            
            log('redirect-result', `‚úÖ User ƒë√£ ƒëƒÉng nh·∫≠p: ${loggedInUser}<br>üîÑ Redirect ƒë·∫øn trang ch√≠nh...`, 'success');
            
            setTimeout(() => {
                window.location.href = 'src/pages/index.html';
            }, 2000);
        }
    </script>
</body>
</html>
